---
layout: post
toc: true
title: "[Matlab]先来点oldschool的PID，再来点现代控制"
categories: MATLAB
tags: [MATLAB, PID, MIMO]
math: true
author:
  - Towl Lynn
---


## 运动学与动力学建模
![cartpole](https://raw.githubusercontent.com/ink-machine/ink-machine.github.io/main/_posts/cartpole.png "一个三岁小孩都喜欢的倒立摆模型")
如图1所示，首先建立一个经典的一阶倒立摆模型，一辆小车顶部通过铰链与一个长杆相连，控制变量为作用于小车的水平推力F，受控变量为杆与竖直向下方向的夹角θ。

| **变量名** | **含义**      | **值**         |
|:---------:|-------------|---------------|
| M       | 小车质量        | 1kg           |
| m       | 杆质量         | 0.2kg         |
| F       | 水平推力-**控制量**    | -             |
| θ       | 杆与竖直向下方向的夹角 | -             |
| b       | 小车摩擦系数      | 0.15N/m/sec   |
| x       | 小车位移        | -             |
| l       | 铰链到杆质心的距离   | 0.2m          |
| I       | 杆相对于铰链的转动惯量 | 0.01067kg*m^2 |
| T       | 采样时间        | 0.05s         |

分别对小车和杆件进行水平受力分析，如图2，可得

$$
\begin{array}{c}
M \dot{x}=F-b \dot{x}-F_{x \text { 杆 }} \\
F_{x \text { 杆 }}=m \ddot{x}+m l \ddot{\theta} \cos \theta-m l \dot{\theta}^{2} \sin \theta \\
F_{y \text { 杆 }}-m g=m l \ddot{\theta} \sin \theta-m l \dot{\theta}^{2} \cos \theta \\
-F_{y \text { 杆 }} l \sin \theta-F_{x \text { 杆 }} l \cos \theta=I \ddot{\theta}
\end{array}
$$
式1为小车的动力学方程，式2-4分别为杆件的水平受力分析、竖直受力分析和力矩平衡方程。由1和2可得运动方程，由式2-4可得另一个运动方程。
$$
\begin{array}{c}
(M+m) \ddot{x}+b \dot{x}+m l \ddot{\theta} \cos \theta-m l \dot{\theta}^{2} \sin \theta=F \\
(I+m l) \ddot{\theta}+m g l \sin \theta=-m l \ddot{x} \cos \theta
\end{array}
$$
![force_analysis](https://raw.githubusercontent.com/ink-machine/ink-machine.github.io/main/_posts/force.png)
由于上式过于复杂，且非线性很强，所以首先在平衡点附近进行线性化简化。根据观察可得$(x=0,\theta=\pi)$和$(x=0,\theta=0)$为系统的两个平衡点，但其中$(x=0,\theta=\pi)$是我们控制的目标，所以在$(x=0,\theta=\pi)$附近线性化，设$\theta=\phi+\pi$，在平衡点附近时有$\sin\theta=-\phi,\cos\theta=-1$，。可以得到线性化后的系统微分方程
$$
\begin{array}{c}
\left(I+m l^{2}\right) \ddot{\phi}-m g l \phi=m l \ddot{x} \\
(M+m) \ddot{x}+b \dot{x}-m l \ddot{\phi}=u
\end{array}
$$
## 状态空间模型
可以看出在上式中出现了位置和角度的二阶倒数，选取$x$，$\dot{x}$,$\phi$，$\dot{\phi}$作为系统状态X，输出Y为$x$,$\phi$,整理上式得
$$
\left\{\begin{array}{l}
\ddot{x}=\frac{-\left(I+m l^{2}\right) b}{I(M+m)+M m l^{2}} \dot{x}+\frac{m^{2} g l^{2}}{I(M+m)+M m l^{2}} \phi+\frac{\left(I+m l^{2}\right)}{I(M+m)+M m l^{2}} u \\
\ddot{\phi}=\frac{-m l b}{I(M+m)+M m l^{2}} \dot{x}+\frac{m g l(M+m)}{I(M+m)+M m l^{2}} \phi+\frac{m l}{I(M+m)+M m l^{2}} u
\end{array}\right.
$$
写作矩阵形式可得，
$$
\left[\begin{array}{c}
\dot{x} \\
\ddot{x} \\
\dot{\phi} \\
\ddot{\phi}
\end{array}\right]=\left[\begin{array}{cccc}
0 & 1 & 0 & 0 \\
0 & \frac{-\left(I+m l^{2}\right) b}{I(M+m)+M m l^{2}} & \frac{m^{2} g l^{2}}{I(M+m)+M m l^{2}} & 0 \\
0 & 0 & 0 & 1 \\
0 & \frac{-m l b}{I(M+m)+M m l^{2}} & \frac{m g l(M+m)}{I(M+m)+M m l^{2}} & 0
\end{array}\right]\left[\begin{array}{l}
x \\
\dot{x} \\
\phi \\
\dot{\phi}
\end{array}\right]+\left[\begin{array}{c}
0 \\
\frac{\left(I+m l^{2}\right)}{I(M+m)+M m l^{2}} \\
0 \\
u \\
\frac{m l}{I(M+m)+M m l^{2}}
\end{array}\right]
$$
$$
\left[\begin{array}{l}
x \\
\phi
\end{array}\right]=\left[\begin{array}{llll}
1 & 0 & 0 & 0 \\
0 & 0 & 1 & 0
\end{array}\right]\left[\begin{array}{l}
x \\
\dot{x} \\
\phi \\
\dot{\phi}
\end{array}\right]
$$
在MATLAB中编写对应代码，控制步长T为0.02s，设置初始状态为$(x=0,\phi=\frac{\pi}{60})$，可以看出系统状态变化剧烈，有震荡衰减趋势，根据物理学常识判断，由于摩擦力的影响，系统最终会稳定在$\theta=0$的状态。所以初始状态是一个不稳定平衡点。
